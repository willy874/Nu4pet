<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG To JS</title>
    <link rel="stylesheet" href="./main.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
        integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
</head>
<body>
    <div class="p-3">
        <div class="p-3 border my-2 d-inline-block">
            <div id="mount" style="width:100px;"></div>
        </div>
        <form id="form">
            <div>
                <div>filename：</div>
                <input id="input" type="text">
            </div>
            <input class="my-4" id="submit" type="submit" value="轉換JS">
        </form>
        <div class="border p-4">
            <div id="text"></div>
        </div>
        <div class="py-4">
            <!-- <details open>
                <summary>Epcot Center</summary>
                <div>123</div>
            </details> -->
        </div>
    </div>
    

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js" integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js" integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj" crossorigin="anonymous"></script>
    <script>
        const SvgFormatRules = [{
                    name: 'text',
                    attrPath: ['transform'],
                    html: true
                },{
                    name: 'path',
                    attrPath: ['d','fill','transform']
                },{
                    name: 'rect',
                    attrPath: ['x','y','width','height','fill','stroke-width','transform']
                },{
                    name: 'polyline',
                    attrPath: ['points','fill','stroke','stroke-width','transform']
                },{
                    name: 'circle',
                    attrPath: ['cx','cy','r','stroke','stroke-width','transform']
                },{
                    name: 'line',
                    attrPath: ['x1','2x','y1','y2','stroke','stroke-width','transform']
                },{
                    name: 'ellipse',
                    attrPath: ['cx','cy','rx','ry','stroke','stroke-width','transform']
                }]

        const mainFunction = (e)=>{
            e.preventDefault()
            const filename = $('#input').val()
            const xhr = new XMLHttpRequest()
            xhr.addEventListener("load", (e)=>{
                const mount = $('#mount')[0]
                mount.innerHTML = e.target.response
                let str = ''
                
                $(SvgFormatRules.map(p=>p.name).join(',')).each((index,el)=>{
                    const findEl = SvgFormatRules.find(p=>p.name===el.tagName)
                    str += [].map.call(mount.querySelectorAll(findEl.name),path=>{
                        return `&nbsp; <${findEl.name} `
                        + (`${findEl.attrPath.map(attr=>$(path).attr(attr) ? `${attr}="${$(path).attr(attr)}"` : '').join(' ')}`) 
                        + (findEl.html ? `>${path.innerHTML}</${findEl.name}>` : '/>')
                    }).join(' ')
                })
                const viewBox = mount.querySelector('svg').getAttribute('viewBox')
                let html = `
                &nbsp; export default {
                &nbsp; mount: '.icon-${filename}',
                &nbsp; attrs: {
                &nbsp; viewBox: '${viewBox}' ,
                &nbsp; fill: 'currentColor' 
                &nbsp; },
                &nbsp; path: \`${str}\`
                &nbsp; }`
                html = html.replace(/\</g,'&lt;')
                html = html.replace(/\>/g,'&gt;')
                html = html.replace(/\&nbsp;/g,'<br/>')
                document.getElementById('text').innerHTML = html
            })
            xhr.open('GET','./src/assets/svg/'+filename+'.svg')
            xhr.send()
        }

        document.getElementById('form').addEventListener('submit',mainFunction)
        document.getElementById('submit').addEventListener('click',mainFunction)




        function ellipseToPath(cx, cy, rx, ry) {
            const kappa=0.5522847498;
            const ox = rx * kappa; // x offset for the control point
            const oy = ry * kappa; // y offset for the control point 
            let d = `M${cx - rx},${cy}`;
                d+= `C${cx - rx}, ${cy - oy}, ${cx - ox}, ${cy - ry}, ${cx}, ${cy - ry},`
                d+= `C${cx + ox}, ${cy - ry}, ${cx + rx}, ${cy - oy}, ${cx + rx}, ${cy},`
                d+= `C${cx + rx}, ${cy + oy}, ${cx + ox}, ${cy + ry}, ${cx}, ${cy + ry},`
                d+= `C${cx - ox}, ${cy + ry}, ${cx - rx}, ${cy + oy}, ${cx - rx}, ${cy},`
                d+= `z`;
            return d;
        }
    </script>
</body>
</html>