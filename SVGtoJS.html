<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG To JS</title>
    
</head>
<body>
    
    <div id="mount" style="width:100px;"></div>
    <form id="form" style="margin: 1rem 0;">
        <div>
            <div>filename：</div>
            <input id="input" type="text">
        </div>
        <input style="margin: 0.5rem 0;" id="submit" type="submit" value="轉換">
    </form>
    <div style="padding: 2rem;border: 1px solid #ddd;">
        <div id="text"></div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        const mainFunction = (e)=>{
            e.preventDefault()
            const filename = $('#input').val()
            const xhr = new XMLHttpRequest()
            xhr.addEventListener("load", (e)=>{
                const mount = $('#mount')[0]
                mount.innerHTML = e.target.response
                let str = ''
                const data = [{
                    name: 'text',
                    attrPath: ['transform'],
                    html: true
                },{
                    name: 'path',
                    attrPath: ['d','fill','transform']
                },{
                    name: 'rect',
                    attrPath: ['x','y','width','height','fill','stroke-width','transform']
                },{
                    name: 'polyline',
                    attrPath: ['points','fill','stroke','stroke-width','transform']
                },{
                    name: 'circle',
                    attrPath: ['cx','cy','r','stroke','stroke-width','transform']
                },{
                    name: 'line',
                    attrPath: ['x1','2x','y1','y2','stroke','stroke-width','transform']
                },{
                    name: 'ellipse',
                    attrPath: ['cx','cy','rx','ry','stroke','stroke-width','transform']
                }]
                $(data.map(p=>p.name).join(',')).each((index,el)=>{
                    const findEl = data.find(p=>p.name===el.tagName)
                    str += [].map.call(mount.querySelectorAll(findEl.name),path=>{
                        return `&nbsp; <${findEl.name} `
                        + (`${findEl.attrPath.map(attr=>$(path).attr(attr) ? `${attr}="${$(path).attr(attr)}"` : '').join(' ')}`) 
                        + (findEl.html ? `>${path.innerHTML}</${findEl.name}>` : '/>')
                    }).join(' ')
                })
                const viewBox = mount.querySelector('svg').getAttribute('viewBox')
                let html = `
                &nbsp; export default {
                &nbsp; mount: '.icon-${filename}',
                &nbsp; attrs: {
                &nbsp; viewBox: '${viewBox}' ,
                &nbsp; fill: 'currentColor' 
                &nbsp; },
                &nbsp; path: \`${str}\`
                &nbsp; }`
                html = html.replace(/\</g,'&lt;')
                html = html.replace(/\>/g,'&gt;')
                html = html.replace(/\&nbsp;/g,'<br/>')
                document.getElementById('text').innerHTML = html
            })
            xhr.open('GET','./src/assets/svg/'+filename+'.svg')
            xhr.send()
        }

        document.getElementById('form').addEventListener('submit',mainFunction)
        document.getElementById('submit').addEventListener('click',mainFunction)
    </script>
</body>
</html>